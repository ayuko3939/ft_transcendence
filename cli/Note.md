# CLI Game Flow Analysis - å‹æ•—æ±ºå®šã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¾©å¸°ã¾ã§

## æ¦‚è¦
CLIã§Pongã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã€å‹æ•—ãŒæ±ºå®šã—ã¦ã‹ã‚‰ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼ã‚’è©³ç´°ã«åˆ†æã€‚

## 1. å‹æ•—æ±ºå®šæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼

### 1.1 WebSocketã‹ã‚‰ã®`gameOver`ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
**ãƒ•ã‚¡ã‚¤ãƒ«**: `game-client.ts:203-207`
```typescript
case "gameOver":
  if (this.handlers.onGameOver) {
    this.handlers.onGameOver(message.result);
  }
  break;
```

### 1.2 GameUIã§ã®å‹æ•—è¡¨ç¤º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `game-ui.ts:182-193`
```typescript
public onGameOver(result: GameResult): void {
  const isWinner = result.winner === this.playerSide;
  
  this.updateStatus(
    `{center}{bold}GAME OVER{/bold}{/center}\n\n` +
    `{center}${isWinner ? "{green-fg}{bold}YOU WIN!{/bold}{/green-fg}" : "{red-fg}{bold}YOU LOSE{/bold}{/red-fg}"}{/center}\n\n` +
    `{center}Final Score{/center}\n` +
    `{center}${result.finalScore.left} - ${result.finalScore.right}{/center}`
  );
  
  this.screen.render();
}
```

## 2. ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®å‡¦ç†

### 2.1 onGameOverãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:193-199`
```typescript
onGameOver: (result) => {
  this.gameUI?.onGameOver(result);
  // 5ç§’å¾Œã«ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç†ã¨Promiseè§£æ±º
  setTimeout(() => {
    this.endGame();
    resolve(); // ã“ã“ã§Promiseã‚’è§£æ±º
  }, 5000);
},
```

**å•é¡Œç‚¹ 1**: 5ç§’å¾…æ©Ÿä¸­ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCtrl+Cã‚’æŠ¼ã™ã¨ã€é©åˆ‡ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

## 3. ã‚²ãƒ¼ãƒ çµ‚äº†å‡¦ç† (`endGame()`)

### 3.1 ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:244-263`
```typescript
private endGame(): void {
  // GameClientã®åˆ‡æ–­
  if (this.gameClient) {
    this.gameClient.disconnect();
    this.gameClient = null;
  }

  // GameUIã®ç ´æ£„
  if (this.gameUI) {
    this.gameUI.destroy();
    this.gameUI = null;
  }

  // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çŠ¶æ…‹ã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
  this.resetTerminal();
  console.log(colors.cyan("ğŸ“ ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚Šã¾ã™..."));
  
  // 100mså¾…æ©Ÿï¼ˆå¿µã®ãŸã‚ï¼‰
  setTimeout(() => {
    // è¿½åŠ ã®çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆï¼ˆå¿µã®ãŸã‚ï¼‰
  }, 100);
}
```

### 3.2 ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:268-281`
```typescript
private resetTerminal(): void {
  // ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¡¨ç¤º
  process.stdout.write('\x1b[?25h');
  // é€šå¸¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ•ã‚¡ã«æˆ»ã‚‹
  process.stdout.write('\x1b[?1049l');
  // ç”»é¢ã‚’ã‚¯ãƒªã‚¢
  console.clear();
  // æ¨™æº–å…¥åŠ›ã‚’é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™
  if (process.stdin.isTTY) {
    process.stdin.setRawMode(false);
  }
  // ãƒãƒƒãƒ•ã‚¡ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
  process.stdout.write('');
}
```

### 3.3 GameUIã®ç ´æ£„å‡¦ç†
**ãƒ•ã‚¡ã‚¤ãƒ«**: `game-ui.ts:329-349`
```typescript
public destroy(): void {
  try {
    // æ¨™æº–å…¥åŠ›ã‚’rawãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰æˆ»ã™
    if (process.stdin.isTTY) {
      process.stdin.setRawMode(false);
    }
    
    // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’ç ´æ£„
    this.screen.destroy();
    
    // ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¡¨ç¤ºã«æˆ»ã™
    process.stdout.write('\x1b[?25h');
    
    // ä»£æ›¿ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒãƒƒãƒ•ã‚¡ã‚’ç„¡åŠ¹åŒ–
    process.stdout.write('\x1b[?1049l');
    
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’ç¶šè¡Œ
    console.error("UI cleanup error:", error);
  }
}
```

**å•é¡Œç‚¹ 2**: `GameUI.destroy()`ã¨`resetTerminal()`ã§åŒã˜å‡¦ç†ãŒé‡è¤‡ã—ã¦ã„ã‚‹ã€‚åŠ¹ç‡æ€§ã®å•é¡Œã€‚

## 4. Promiseã®è§£æ±ºã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—å¾©å¸°

### 4.1 startGame()ã®Promiseè§£æ±º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:153-239`
```typescript
return new Promise<void>((resolve, reject) => {
  // ... ã‚²ãƒ¼ãƒ å‡¦ç† ...
  
  onGameOver: (result) => {
    this.gameUI?.onGameOver(result);
    setTimeout(() => {
      this.endGame();
      resolve(); // â† ã“ã“ã§PromiseãŒè§£æ±ºã•ã‚Œã‚‹
    }, 5000);
  },
  
  // ... ä»–ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ...
});
```

### 4.2 ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã®å‡¦ç†ç¶™ç¶š
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:52-59`
```typescript
const action = await this.showMainMenu();
switch (action) {
  case "random":
    await this.joinRandomGame(); // â† startGame()ã®PromiseãŒresolveã•ã‚Œã¦æˆ»ã£ã¦ãã‚‹
    break;
  case "logout":
    await this.logout();
    return;
  case "exit":
    await this.cleanup();
    return;
}
```

### 4.3 ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `index.ts:117-140`
```typescript
private async showMainMenu(): Promise<string> {
  try {
    const answer = await inquirer.prompt([
      {
        type: "list",
        name: "action",
        message: "ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
        choices: [
          { name: "ğŸ® ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒƒãƒã«å‚åŠ ", value: "random" },
          { name: "ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ", value: "logout" },
          { name: "âŒ çµ‚äº†", value: "exit" },
        ],
      },
    ]);
    return answer.action;
  } catch (error: any) {
    // ExitPromptErrorã®å ´åˆã¯æ­£å¸¸çµ‚äº†ã¨ã—ã¦æ‰±ã†
    if (error?.name === "ExitPromptError") {
      return "exit";
    }
    throw error;
  }
}
```

## 5. ç‰¹å®šã•ã‚ŒãŸå•é¡Œç‚¹ã¨æ½œåœ¨çš„ãªæ”¹å–„ç‚¹

### å•é¡Œç‚¹ 1: ã‚²ãƒ¼ãƒ çµ‚äº†å¾…æ©Ÿä¸­ã®å¼·åˆ¶çµ‚äº†å‡¦ç†
**è©³ç´°**: 5ç§’ã®å¾…æ©Ÿä¸­ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCtrl+Cã‚’æŠ¼ã—ãŸå ´åˆã€`endGame()`ãŒå‘¼ã°ã‚Œãšã«ãƒªã‚½ãƒ¼ã‚¹ãŒæ®‹ã‚‹å¯èƒ½æ€§

**è§£æ±ºç­–**:
```typescript
// ã‚¿ã‚¤ãƒãƒ¼IDã‚’ä¿å­˜ã—ã¦ã€å¿…è¦ã«å¿œã˜ã¦ã‚¯ãƒªã‚¢
let gameOverTimer: NodeJS.Timeout | null = null;

onGameOver: (result) => {
  this.gameUI?.onGameOver(result);
  gameOverTimer = setTimeout(() => {
    this.endGame();
    resolve();
  }, 5000);
},

// onQuitã‚„ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
this.gameUI.onQuit = () => {
  if (gameOverTimer) {
    clearTimeout(gameOverTimer);
    gameOverTimer = null;
  }
  this.endGame();
  resolve();
};
```

### å•é¡Œç‚¹ 2: é‡è¤‡ã™ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒªã‚»ãƒƒãƒˆå‡¦ç†
**è©³ç´°**: `GameUI.destroy()`ã¨`resetTerminal()`ã§åŒã˜ANSIã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã‚‹

**è§£æ±ºç­–**: ã©ã¡ã‚‰ã‹ä¸€æ–¹ã«çµ±ä¸€ã™ã‚‹ã‹ã€é †åºã‚’æ˜ç¢ºã«ã™ã‚‹

### å•é¡Œç‚¹ 3: éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ
**è©³ç´°**: `endGame()`å†…ã®100mså¾…æ©Ÿã®ç›®çš„ãŒä¸æ˜ç¢ºã§ã€å¿…è¦æ€§ãŒç–‘å•

**è§£æ±ºç­–**: æ˜ç¢ºãªç†ç”±ãŒãªã„é™ã‚Šå‰Šé™¤ã™ã‚‹ã‹ã€ã‚³ãƒ¡ãƒ³ãƒˆã§èª¬æ˜

### å•é¡Œç‚¹ 4: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸å®Œå…¨æ€§
**è©³ç´°**: WebSocketåˆ‡æ–­ã‚„UIç ´æ£„æ™‚ã®ã‚¨ãƒ©ãƒ¼ãŒé©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„å ´åˆãŒã‚ã‚‹

**è§£æ±ºç­–**: ã‚ˆã‚Šå …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

## 6. æ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„ç‚¹

1. **ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã®æ”¹å–„**: ã‚²ãƒ¼ãƒ çµ‚äº†å¾…æ©Ÿã‚¿ã‚¤ãƒãƒ¼ã®é©åˆ‡ãªç®¡ç†
2. **é‡è¤‡å‡¦ç†ã®å‰Šé™¤**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã®çµ±ä¸€
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–**: å„æ®µéšã§ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å……å®Ÿ
4. **çŠ¶æ…‹ç®¡ç†ã®æ˜ç¢ºåŒ–**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®æ˜ç¢ºãªç®¡ç†
5. **ãƒ­ã‚°å‡ºåŠ›ã®æ”¹å–„**: ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°å‡ºåŠ›ã®è¿½åŠ 

## 7. ç¾åœ¨ã®å‹•ä½œç¢ºèªçŠ¶æ³

- âœ… ã‚²ãƒ¼ãƒ çµ‚äº†å¾Œã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¾©å¸°
- âœ… ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆ
- âœ… blessed UIã¨inquirerã®ç«¶åˆè§£æ±º
- âœ… å¼·åˆ¶çµ‚äº†æ™‚ã®å®Œå…¨ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
- âœ… å‡¦ç†åŠ¹ç‡ã®æœ€é©åŒ–ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰

## 8. å®Ÿè£…ã•ã‚ŒãŸä¿®æ­£å†…å®¹ (2024å¹´å®Ÿæ–½)

### 8.1 ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ã®æ”¹å–„
**å•é¡Œ**: 5ç§’å¾…æ©Ÿä¸­ã®å¼·åˆ¶çµ‚äº†ã§é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒã•ã‚Œãªã„

**ä¿®æ­£å†…å®¹**:
- `gameEndTimer: NodeJS.Timeout | null`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
- `clearGameEndTimer()`ãƒ¡ã‚½ãƒƒãƒ‰ã§ä¸€å…ƒçš„ãªã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
- å…¨ã¦ã®çµ‚äº†ãƒ‘ã‚¹ã§ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢ã‚’å®Ÿè¡Œ

**å®Ÿè£…å ´æ‰€**:
```typescript
// index.ts
private gameEndTimer: NodeJS.Timeout | null = null;

private clearGameEndTimer(): void {
  if (this.gameEndTimer) {
    clearTimeout(this.gameEndTimer);
    this.gameEndTimer = null;
  }
}

// onGameOver, onError, onDisconnected, onQuitã®å…¨ã¦ã§ã‚¯ãƒªã‚¢
```

### 8.2 é‡è¤‡å‡¦ç†ã®å‰Šé™¤
**å•é¡Œ**: `GameUI.destroy()`ã¨`resetTerminal()`ã§åŒã˜ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒªã‚»ãƒƒãƒˆå‡¦ç†

**ä¿®æ­£å†…å®¹**:
- `GameUI.destroy()`ã¯blessed screenã®ç ´æ£„ã®ã¿ã«ç‰¹åŒ–
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çŠ¶æ…‹ã®ãƒªã‚»ãƒƒãƒˆã¯`resetTerminal()`ã«çµ±ä¸€
- è²¬ä»»åˆ†é›¢ã®åŸå‰‡ã«å¾“ã£ãŸè¨­è¨ˆ

### 8.3 ä¸æ˜ç¢ºãªå¾…æ©Ÿå‡¦ç†ã®å‰Šé™¤
**å•é¡Œ**: `endGame()`å†…ã®ä¸æ˜ç¢ºãª100mså¾…æ©Ÿ

**ä¿®æ­£å†…å®¹**:
- ç›®çš„ä¸æ˜ã®100ms `setTimeout`ã‚’å‰Šé™¤
- åŒæœŸçš„ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼ã«å¤‰æ›´

### 8.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
**å•é¡Œ**: ã‚¨ãƒ©ãƒ¼æ™‚ã®ä¸å®Œå…¨ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**ä¿®æ­£å†…å®¹**:
- å…¨ã¦ã®ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰ã«try-catchè¿½åŠ 
- å„å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã‚’å€‹åˆ¥ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’ç¶™ç¶š

**å¼·åŒ–ã•ã‚ŒãŸç®‡æ‰€**:
- `endGame()`: GameClientã€GameUIã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒªã‚»ãƒƒãƒˆã®å„å‡¦ç†
- `resetTerminal()`: å„ANSIã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®å€‹åˆ¥å‡¦ç†
- `cleanup()`: å…¨ã¦ã®çµ‚äº†å‡¦ç†ã®å®‰å…¨ãªå®Ÿè¡Œ
- ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ãƒãƒ³ãƒ‰ãƒ©ãƒ¼: SIGINTæ™‚ã®å®‰å…¨ãªçµ‚äº†

## 9. ä¿®æ­£å¾Œã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 9.1 æ­£å¸¸ãªå‹æ•—æ±ºå®šæ™‚
1. `onGameOver`ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
2. UIè¡¨ç¤ºæ›´æ–°
3. 5ç§’ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ï¼ˆ`gameEndTimer`ã§ç®¡ç†ï¼‰
4. ã‚¿ã‚¤ãƒãƒ¼å®Œäº†å¾Œï¼š
   - `clearGameEndTimer()`ã§ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢
   - `endGame()`ã§å®‰å…¨ãªãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
   - PromiseãŒè§£æ±ºã•ã‚Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—ã«å¾©å¸°

### 9.2 å¼·åˆ¶çµ‚äº†æ™‚ï¼ˆCtrl+Cç­‰ï¼‰
1. `onQuit`ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®Ÿè¡Œ
2. `clearGameEndTimer()`ã§æ—¢å­˜ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
3. `endGame()`ã§å³åº§ã«ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
4. PromiseãŒè§£æ±ºã•ã‚Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ«ãƒ¼ãƒ—ã«å¾©å¸°

### 9.3 ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
1. å„å‡¦ç†ã§try-catchã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ
2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›
3. å‡¦ç†ç¶™ç¶šï¼ˆå¯èƒ½ãªé™ã‚Šï¼‰
4. ç¢ºå®Ÿãªãƒªã‚½ãƒ¼ã‚¹è§£æ”¾

## 10. æ”¹å–„åŠ¹æœ

- **å®‰å®šæ€§å‘ä¸Š**: ã©ã®çµ‚äº†ãƒ‘ã‚¹ã§ã‚‚ç¢ºå®Ÿãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **ä¿å®ˆæ€§å‘ä¸Š**: è²¬ä»»åˆ†é›¢ã«ã‚ˆã‚‹æ˜ç¢ºãªæ§‹é€ 
- **ãƒ‡ãƒãƒƒã‚°æ€§å‘ä¸Š**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å‡ºåŠ›
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å‘ä¸Š**: ã‚ˆã‚Šå®‰å®šã—ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼å¾©å¸°

## 11. ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å•é¡Œã®è¿½åŠ ä¿®æ­£ (2024å¹´å®Ÿæ–½)

### 11.1 å•é¡Œ
ã‚²ãƒ¼ãƒ çµ‚äº†å¾Œã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ã®å‹•ä½œãŒé€†è»¢ã™ã‚‹ï¼ˆâ†“ã‚­ãƒ¼ã§é¸æŠè‚¢ãŒä¸Šã«ç§»å‹•ï¼‰

### 11.2 åŸå› åˆ†æ
- blessed UIã®rawãƒ¢ãƒ¼ãƒ‰è¨­å®šãŒinquirerã«å½±éŸ¿
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã£ã¦ã„ãªã„
- stdin ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒæ®‹ç•™ã—ã¦ã„ã‚‹å¯èƒ½æ€§

### 11.3 ä¿®æ­£å†…å®¹

#### A. `resetTerminal()`ã®å¼·åŒ–
```typescript
private resetTerminal(): void {
  // 1. æ¨™æº–å…¥åŠ›ã‚’rawãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ç¢ºå®Ÿã«æˆ»ã™
  if (process.stdin.isTTY) {
    process.stdin.setRawMode(false);
  }
  
  // 2. æ®‹ç•™ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢
  process.stdin.removeAllListeners('keypress');
  process.stdin.removeAllListeners('data');
  
  // 3. ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’é€šå¸¸ã«æˆ»ã™
  process.stdout.write('\x1b[?1l'); // Normal cursor key mode
  
  // 4. ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
  process.stdout.write('\x1b[?1h\x1b=');
}
```

#### B. ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºå‰ã®åˆæœŸåŒ–
```typescript
private initializeTerminalForMenu(): void {
  // TTYã®è¨­å®šã‚’æ˜ç¤ºçš„ã«ãƒªã‚»ãƒƒãƒˆ
  if (process.stdin.isTTY) {
    process.stdin.setRawMode(false);
    process.stdin.resume();
  }
  
  // é€šå¸¸ã®ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™
  process.stdout.write('\x1b[?1l\x1b>');
}
```

#### C. ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã§ã®ç¢ºå®ŸãªåˆæœŸåŒ–
- å„ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºå‰ã«`initializeTerminalForMenu()`ã‚’å‘¼ã³å‡ºã—
- åˆå›èµ·å‹•æ™‚ã¨åŒã˜çŠ¶æ…‹ã‚’ç¶­æŒ

### 11.4 ä¿®æ­£åŠ¹æœ

- **æ­£å¸¸ãªã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: ã‚²ãƒ¼ãƒ å¾Œã‚‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ãŒæ­£å¸¸å‹•ä½œ
- **ä¸€è²«ã—ãŸå‹•ä½œ**: åˆå›èµ·å‹•æ™‚ã¨åŒã˜æ“ä½œæ„Ÿã‚’ç¶­æŒ
- **å …ç‰¢æ€§**: è¤‡æ•°å›ã®ã‚²ãƒ¼ãƒ å¾Œã‚‚å®‰å®šã—ãŸå‹•ä½œ

## 12. ç·åˆçš„ãªå®‰å®šæ€§å‘ä¸Š

ã“ã‚Œã‚‰ã®ä¿®æ­£ã«ã‚ˆã‚Šã€CLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ç‚¹ã§å¤§å¹…ã«æ”¹å–„ï¼š

1. **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: ç¢ºå®Ÿãªã‚¿ã‚¤ãƒãƒ¼ã¨ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
2. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çŠ¶æ…‹**: blessed UIã¨inquireré–“ã§ã®é©åˆ‡ãªçŠ¶æ…‹ç®¡ç†
3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹äºˆæœŸã—ãªã„çµ‚äº†ã®é˜²æ­¢
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ä¸€è²«ã—ãŸæ“ä½œæ„Ÿã¨ã‚¹ãƒ ãƒ¼ã‚ºãªãƒ¡ãƒ‹ãƒ¥ãƒ¼å¾©å¸°